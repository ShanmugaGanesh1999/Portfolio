# Design Deployment System

> CI/CD pipeline for reliable software deployments

---

## ðŸ“‹ Problem Statement

Design a deployment system like Kubernetes/Spinnaker that handles building, testing, and deploying software to production with safety and reliability.

---

## R - Requirements

### Functional Requirements

```
1. Build applications from source code
2. Run automated tests
3. Deploy to multiple environments (dev, staging, prod)
4. Rolling deployments with health checks
5. Rollback on failure
6. Blue-green and canary deployments
7. Configuration management
8. Deployment history and audit trail
```

### Non-Functional Requirements

```
1. High reliability (deployments never leave system broken)
2. Fast rollbacks (<5 minutes)
3. Zero-downtime deployments
4. Handle 1000s of deployments/day
5. Support multiple cloud providers
```

---

## H - High-Level Design

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                              â”‚
â”‚   Developer                                                  â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                             â”‚
â”‚   â”‚ Git Push  â”‚                                             â”‚
â”‚   â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜                                             â”‚
â”‚         â”‚ Webhook                                            â”‚
â”‚         â–¼                                                    â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚                  CI/CD Pipeline                       â”‚  â”‚
â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚
â”‚   â”‚  â”‚ Build  â”‚â†’ â”‚ Test â”‚â†’ â”‚Publishâ”‚â†’ â”‚    Deploy      â”‚ â”‚  â”‚
â”‚   â”‚  â”‚        â”‚  â”‚      â”‚  â”‚ Image â”‚  â”‚                â”‚ â”‚  â”‚
â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                  â”‚           â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚   â”‚               Deployment Orchestrator                  â”‚ â”‚
â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚   â”‚  â”‚  Strategy: Rolling â”‚ Blue-Green â”‚ Canary         â”‚ â”‚ â”‚
â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                â”‚                             â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚               Target Infrastructure                   â”‚  â”‚
â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚  â”‚
â”‚   â”‚  â”‚ Node 1 â”‚  â”‚ Node 2 â”‚  â”‚ Node 3 â”‚  â”‚ Node N â”‚     â”‚  â”‚
â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## D - Detailed Design

### Build Pipeline

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Build Stage                                     â”‚
â”‚                                                              â”‚
â”‚   Trigger: Git push or manual                               â”‚
â”‚                                                              â”‚
â”‚   Steps:                                                     â”‚
â”‚   1. Checkout code                                          â”‚
â”‚   2. Install dependencies                                   â”‚
â”‚   3. Compile/build                                          â”‚
â”‚   4. Run unit tests                                         â”‚
â”‚   5. Static analysis (linting, security scan)              â”‚
â”‚   6. Build container image                                  â”‚
â”‚   7. Push to registry                                       â”‚
â”‚   8. Update deployment manifest                             â”‚
â”‚                                                              â”‚
â”‚   Build specification (e.g., pipeline.yaml):                â”‚
â”‚   ```yaml                                                   â”‚
â”‚   stages:                                                   â”‚
â”‚     - name: build                                           â”‚
â”‚       image: node:18                                        â”‚
â”‚       commands:                                             â”‚
â”‚         - npm install                                       â”‚
â”‚         - npm run build                                     â”‚
â”‚         - npm test                                          â”‚
â”‚                                                              â”‚
â”‚     - name: docker                                          â”‚
â”‚       commands:                                             â”‚
â”‚         - docker build -t app:$COMMIT_SHA .                â”‚
â”‚         - docker push registry/app:$COMMIT_SHA            â”‚
â”‚   ```                                                       â”‚
â”‚                                                              â”‚
â”‚   Artifacts:                                                 â”‚
â”‚   â”œâ”€â”€ Container image with commit SHA tag                  â”‚
â”‚   â”œâ”€â”€ Build logs                                           â”‚
â”‚   â”œâ”€â”€ Test results                                         â”‚
â”‚   â””â”€â”€ Security scan report                                 â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Deployment Strategies

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Rolling Deployment                              â”‚
â”‚                                                              â”‚
â”‚   Gradually replace old pods with new                       â”‚
â”‚                                                              â”‚
â”‚   Time â†’                                                    â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚ v1 â”‚ v1 â”‚ v1 â”‚ v1 â”‚ v1 â”‚  Initial                  â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚ v2 â”‚ v1 â”‚ v1 â”‚ v1 â”‚ v1 â”‚  Replace 1st             â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚ v2 â”‚ v2 â”‚ v1 â”‚ v1 â”‚ v1 â”‚  Replace 2nd             â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚ v2 â”‚ v2 â”‚ v2 â”‚ v2 â”‚ v2 â”‚  Complete                â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                              â”‚
â”‚   Parameters:                                                â”‚
â”‚   â”œâ”€â”€ maxUnavailable: 25% (min available during update)   â”‚
â”‚   â”œâ”€â”€ maxSurge: 25% (extra pods during update)            â”‚
â”‚   â””â”€â”€ minReadySeconds: 30 (wait before marking healthy)   â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Blue-Green Deployment                           â”‚
â”‚                                                              â”‚
â”‚   Two identical environments, switch traffic instantly      â”‚
â”‚                                                              â”‚
â”‚                     Load Balancer                            â”‚
â”‚                          â”‚                                   â”‚
â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”‚
â”‚              â–¼                       â–¼                       â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚   â”‚   Blue (v1)      â”‚    â”‚   Green (v2)     â”‚              â”‚
â”‚   â”‚   â† LIVE         â”‚    â”‚   â† STAGED       â”‚              â”‚
â”‚   â”‚   â”Œâ”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”  â”‚    â”‚   â”Œâ”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”  â”‚              â”‚
â”‚   â”‚   â”‚ v1 â”‚ â”‚ v1 â”‚  â”‚    â”‚   â”‚ v2 â”‚ â”‚ v2 â”‚  â”‚              â”‚
â”‚   â”‚   â””â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”˜  â”‚    â”‚   â””â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”˜  â”‚              â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚                                                              â”‚
â”‚   Steps:                                                     â”‚
â”‚   1. Deploy v2 to Green (inactive)                         â”‚
â”‚   2. Test Green environment                                â”‚
â”‚   3. Switch LB to point to Green                           â”‚
â”‚   4. Green is now live, Blue is standby                    â”‚
â”‚   5. If problems: instant rollback (switch back)           â”‚
â”‚                                                              â”‚
â”‚   Pros: Instant rollback, clean separation                  â”‚
â”‚   Cons: 2Ã— infrastructure cost                              â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Canary Deployment                               â”‚
â”‚                                                              â”‚
â”‚   Route small % of traffic to new version                   â”‚
â”‚                                                              â”‚
â”‚   Traffic split:                                             â”‚
â”‚                                                              â”‚
â”‚   100% â†’ v1                    (Start)                      â”‚
â”‚    95% â†’ v1, 5% â†’ v2           (Canary start)               â”‚
â”‚    80% â†’ v1, 20% â†’ v2          (Increase if healthy)        â”‚
â”‚    50% â†’ v1, 50% â†’ v2          (Continue)                   â”‚
â”‚     0% â†’ v1, 100% â†’ v2         (Complete rollout)           â”‚
â”‚                                                              â”‚
â”‚   Automated analysis:                                        â”‚
â”‚   â”œâ”€â”€ Compare error rates (v1 vs v2)                       â”‚
â”‚   â”œâ”€â”€ Compare latency percentiles                          â”‚
â”‚   â”œâ”€â”€ Compare resource usage                               â”‚
â”‚   â””â”€â”€ If v2 worse â†’ auto rollback                          â”‚
â”‚                                                              â”‚
â”‚   Configuration:                                             â”‚
â”‚   ```yaml                                                   â”‚
â”‚   strategy:                                                  â”‚
â”‚     type: canary                                            â”‚
â”‚     steps:                                                   â”‚
â”‚       - weight: 5                                           â”‚
â”‚         pause: {duration: 10m}                              â”‚
â”‚       - weight: 20                                          â”‚
â”‚         pause: {duration: 10m}                              â”‚
â”‚       - weight: 50                                          â”‚
â”‚         pause: {duration: 10m}                              â”‚
â”‚       - weight: 100                                         â”‚
â”‚   ```                                                       â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Health Checks

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Health Checking                                 â”‚
â”‚                                                              â”‚
â”‚   Types:                                                     â”‚
â”‚                                                              â”‚
â”‚   1. Liveness probe: Is the app alive?                      â”‚
â”‚      - HTTP GET /healthz returns 200                       â”‚
â”‚      - If fails â†’ restart container                        â”‚
â”‚                                                              â”‚
â”‚   2. Readiness probe: Is the app ready for traffic?        â”‚
â”‚      - HTTP GET /ready returns 200                         â”‚
â”‚      - If fails â†’ remove from load balancer               â”‚
â”‚                                                              â”‚
â”‚   3. Startup probe: Has the app started?                   â”‚
â”‚      - For slow-starting apps                              â”‚
â”‚      - Delays liveness checks until startup complete       â”‚
â”‚                                                              â”‚
â”‚   Configuration:                                             â”‚
â”‚   ```yaml                                                   â”‚
â”‚   livenessProbe:                                            â”‚
â”‚     httpGet:                                                â”‚
â”‚       path: /healthz                                        â”‚
â”‚       port: 8080                                            â”‚
â”‚     initialDelaySeconds: 30                                 â”‚
â”‚     periodSeconds: 10                                       â”‚
â”‚     failureThreshold: 3                                     â”‚
â”‚                                                              â”‚
â”‚   readinessProbe:                                           â”‚
â”‚     httpGet:                                                â”‚
â”‚       path: /ready                                          â”‚
â”‚       port: 8080                                            â”‚
â”‚     periodSeconds: 5                                        â”‚
â”‚   ```                                                       â”‚
â”‚                                                              â”‚
â”‚   Deployment gate:                                           â”‚
â”‚   - New pod must pass readiness before old pod terminated  â”‚
â”‚   - Prevents bad deployments from taking down service      â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Rollback Mechanism

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Rollback                                        â”‚
â”‚                                                              â”‚
â”‚   Automatic triggers:                                        â”‚
â”‚   â”œâ”€â”€ Health check failures exceed threshold               â”‚
â”‚   â”œâ”€â”€ Error rate spikes                                    â”‚
â”‚   â”œâ”€â”€ Latency degradation                                  â”‚
â”‚   â””â”€â”€ Manual trigger                                       â”‚
â”‚                                                              â”‚
â”‚   Rollback strategies:                                       â”‚
â”‚                                                              â”‚
â”‚   1. Version rollback:                                      â”‚
â”‚      - Keep last N versions available                      â”‚
â”‚      - Deploy previous known-good version                  â”‚
â”‚      - Same deployment process as forward                  â”‚
â”‚                                                              â”‚
â”‚   2. Blue-green rollback:                                   â”‚
â”‚      - Just switch LB back to old environment             â”‚
â”‚      - Instant (<1 second)                                 â”‚
â”‚                                                              â”‚
â”‚   3. Canary rollback:                                       â”‚
â”‚      - Route 100% traffic back to stable version          â”‚
â”‚      - Terminate canary pods                               â”‚
â”‚                                                              â”‚
â”‚   Version storage:                                           â”‚
â”‚   - Container images tagged with commit SHA               â”‚
â”‚   - Config versions in Git (GitOps)                        â”‚
â”‚   - Database migrations must be backward-compatible        â”‚
â”‚                                                              â”‚
â”‚   Command:                                                   â”‚
â”‚   kubectl rollout undo deployment/myapp                     â”‚
â”‚   # or                                                      â”‚
â”‚   kubectl rollout undo deployment/myapp --to-revision=3     â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Configuration Management

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Configuration                                   â”‚
â”‚                                                              â”‚
â”‚   Layers:                                                    â”‚
â”‚   1. Default config (in code)                              â”‚
â”‚   2. Environment config (dev/staging/prod)                 â”‚
â”‚   3. Secret injection (vault, k8s secrets)                 â”‚
â”‚   4. Feature flags (runtime toggles)                       â”‚
â”‚                                                              â”‚
â”‚   GitOps approach:                                           â”‚
â”‚   â”œâ”€â”€ All config in Git                                    â”‚
â”‚   â”œâ”€â”€ Pull-based deployment (ArgoCD/Flux)                 â”‚
â”‚   â”œâ”€â”€ Audit trail via Git history                         â”‚
â”‚   â””â”€â”€ Easy rollback (git revert)                          â”‚
â”‚                                                              â”‚
â”‚   Repo structure:                                            â”‚
â”‚   ```                                                       â”‚
â”‚   config/                                                   â”‚
â”‚   â”œâ”€â”€ base/                                                â”‚
â”‚   â”‚   â”œâ”€â”€ deployment.yaml                                 â”‚
â”‚   â”‚   â””â”€â”€ service.yaml                                    â”‚
â”‚   â”œâ”€â”€ dev/                                                 â”‚
â”‚   â”‚   â””â”€â”€ kustomization.yaml                              â”‚
â”‚   â”œâ”€â”€ staging/                                             â”‚
â”‚   â”‚   â””â”€â”€ kustomization.yaml                              â”‚
â”‚   â””â”€â”€ prod/                                                â”‚
â”‚       â””â”€â”€ kustomization.yaml                              â”‚
â”‚   ```                                                       â”‚
â”‚                                                              â”‚
â”‚   Secrets:                                                   â”‚
â”‚   â”œâ”€â”€ Never in Git (use sealed-secrets or external)       â”‚
â”‚   â”œâ”€â”€ HashiCorp Vault integration                         â”‚
â”‚   â”œâ”€â”€ AWS Secrets Manager                                  â”‚
â”‚   â””â”€â”€ Kubernetes external-secrets                         â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Pipeline Orchestration

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Pipeline Stages                                 â”‚
â”‚                                                              â”‚
â”‚   Full pipeline:                                             â”‚
â”‚                                                              â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚ Build â”‚ Test â”‚ Security â”‚ Dev â”‚ Staging â”‚   Prod    â”‚   â”‚
â”‚   â”‚       â”‚      â”‚  Scan    â”‚     â”‚         â”‚           â”‚   â”‚
â”‚   â””â”€â”€â”€â”¬â”€â”€â”€â”´â”€â”€â”€â”¬â”€â”€â”´â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”´â”€â”€â”¬â”€â”€â”´â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜   â”‚
â”‚       â”‚       â”‚       â”‚        â”‚       â”‚          â”‚         â”‚
â”‚       â–¼       â–¼       â–¼        â–¼       â–¼          â–¼         â”‚
â”‚    [Auto]  [Auto]  [Auto]   [Auto]  [Auto]   [Manual Gate]  â”‚
â”‚                                                              â”‚
â”‚   Environment promotion:                                     â”‚
â”‚   â”œâ”€â”€ Dev: auto-deploy on merge to main                    â”‚
â”‚   â”œâ”€â”€ Staging: auto-deploy after dev                       â”‚
â”‚   â”œâ”€â”€ Prod: manual approval required                       â”‚
â”‚   â””â”€â”€ Prod: canary first, then full rollout               â”‚
â”‚                                                              â”‚
â”‚   Quality gates:                                             â”‚
â”‚   â”œâ”€â”€ All tests pass                                       â”‚
â”‚   â”œâ”€â”€ Code coverage > 80%                                  â”‚
â”‚   â”œâ”€â”€ No high/critical vulnerabilities                     â”‚
â”‚   â”œâ”€â”€ Performance benchmarks met                           â”‚
â”‚   â””â”€â”€ Staging smoke tests pass                             â”‚
â”‚                                                              â”‚
â”‚   Approvals:                                                 â”‚
â”‚   â”œâ”€â”€ Slack/Teams notification                             â”‚
â”‚   â”œâ”€â”€ Require N approvers                                  â”‚
â”‚   â”œâ”€â”€ Time-based (no Friday deploys)                       â”‚
â”‚   â””â”€â”€ Change window restrictions                           â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ðŸ“Š Summary

```
Key Components:
â”œâ”€â”€ Build Service: Compile, test, create artifacts
â”œâ”€â”€ Deployment Orchestrator: Strategy execution
â”œâ”€â”€ Health Checker: Liveness/readiness monitoring
â”œâ”€â”€ Config Manager: GitOps-based configuration

Key Decisions:
â”œâ”€â”€ Rolling deployment for most cases
â”œâ”€â”€ Canary for high-risk changes
â”œâ”€â”€ Blue-green for instant rollback needs
â”œâ”€â”€ GitOps for config management

Safety Features:
â”œâ”€â”€ Automated rollback on failures
â”œâ”€â”€ Health checks before traffic shift
â”œâ”€â”€ Manual gates for production
â”œâ”€â”€ Audit trail for all changes
```
